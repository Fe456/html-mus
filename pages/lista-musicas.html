<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lista de usuários (Admin)</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <link href="style.css" rel="stylesheet" />
    <script src="https://bundle.run/buffer@6.0.3"></script>
    <script type="module">
      const listar = async () => {
        console.log("chamou a função listar");

        const response = await fetch(`http://localhost:3000/musicas`, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        });

        const musicas = await response.json();
        const tabelaMusicas = document.getElementById("tabelaMusicas");

        musicas.forEach((musica, indice) => {
          var row = tabelaMusicas.insertRow(indice + 1);
          var cell1 = row.insertCell(0);
          var cell2 = row.insertCell(1);
          var cell3 = row.insertCell(2);
          var cell4 = row.insertCell(3);
          var cell5 = row.insertCell(4);
          var cell6 = row.insertCell(5);
          var cell7 = row.insertCell(6);

          const imgBase64 = btoa(
            String.fromCharCode(...new Uint8Array(musica.IMG_COVER.data))
          );

          cell1.innerHTML = musica.ID;
          cell2.innerHTML = musica.NOME;
          cell3.innerHTML = musica.ARTISTA;
          cell4.innerHTML = `<img src="data:image/jpeg;base64,${imgBase64}" alt="Capa" style="max-width: 100px;">`;
          cell5.innerHTML = `
    <audio controls>
        <source src="http://localhost:3000/musicas/audio/${musica.ID}" type="audio/mpeg">
        Seu navegador não suporta o player de áudio.
    </audio>`;
          cell6.innerHTML = '<button class="btn btn-primary">Editar</button>';
          cell7.innerHTML = '<button class="btn btn-danger">Excluir</button>';
        });
      };
      listar();
    </script>
  </head>

  <body style="background-color: rgb(39, 38, 38)">
    <div class="container" style="width: 63%; overflow: auto">
      <h2>Lista de Usuários</h2>
      <br />
      <div class="row">
        <div class="col-8">
          <input type="text" class="form-control" />
        </div>
        <div class="col-4" style="display: flex; height: 45px">
          <button class="btn btn-primary">Pesquisar</button>
          <div class="divider"></div>
          <button
            class="btn btn-secondary"
            onclick="location.href= 'cadastrar.html'"
            style="padding: 0"
          >
            Novo Usuário
          </button>
        </div>

        <table
          id="tabelaMusicas"
          class="table table-striped table-hover table-dark"
        >
          <thead>
            <tr>
              <th scope="col">ID</th>
              <th scope="col">Nome</th>
              <th scope="col">Artista</th>
              <th scope="col">Imagem</th>
              <th scope="col">Audio</th>
              <th scope="col"></th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>